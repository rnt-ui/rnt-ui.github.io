# 2025-09-04｜開発日記（UI SOUR R8）

きょうは **v0.98–Ø** を軸に、命名整理・SPILL手順・初期向きの決定を確定。**物質性（氷／レモン）**と**構造（Order/T/TF）**の接続を明瞭にし、運用負荷を増やさない方針でまとめた。

---

## 決定事項（確定）

### 命名

- 「仕込みA」→ **「仕込み」**に統一（挙動は不変）。
    

### 仕込み：Ø（素材なし）と部分許容

- **端ロック**（5/5でCW、0/5でCCW）＝ **Ø**：その枠は**投入なし／クリックなし**。
    
- **部分しか入らない**：**端までの最小分（最低 +1/5 相当）だけ入れる**。残りは入れない。
    
- ガード：**Øは1サイクル最大2枠**／**同一素材の連続Ø禁止**。
    
- 手順は **素材→ノブ**（＝投入量ぶんクリック）。
    

### TU／TF（v0.98の運用を維持）

- **T非依存の優先表**で統一（刺：RISE→MULTI→FALL／だ：RISE→OT→MULTI／無：VARI（CW→不可ならCCW））。
    
- **端ノブ回避**（端在位は選ばない／**+1で端到達はOK**）。
    
- **TUのみ**全候補不可なら**空振りTU**可（素材は入れる・ノブは据え置き）。
    

### SPILL（定義とイベント｜最終版）

- **定義**：**仕込み**または**TU**の投入で**実際に溢れた瞬間のみ**SPILL。
    
- **イベント手順**
    
    1. 進行中の工程を中断（残りの仕込み枠・TU・ステアは中止）
        
    2. **T3＋ALL+1/5**（端は端で停止）
        
    3. **音タグ=刺固定**（次の仕込み開始までの暫定タグ）
        
    4. **飲む（＝通常どおり TF を含む）**
        
        - TF：優先表／端ノブ回避／±1/5
            
        - **Orderを即時更新**（TFの対象×向きで回転）
            
        - **SeedTag(next) = TF判定時のタグ**
            
    5. **残骸除去**（氷・レモン片）→ **RS=0**
        
    6. **休憩 1分**
        
    7. **次サイクルへ**
        
- **次サイクル初期条件**：**T再抽選／FM=12時／ステア回数=1回／Order=更新後**。  
    **初手の向き = T × SeedTag(next)**（以降は各手の聴取タグが次ノブの向きを規定）。
    

### 残骸（RS）の扱い

- **RS**＝氷の**個数**・レモンの**しぼり数**を保持。
    
- **仕込みで入れた分だけ**RSに加算（TU投入の固形は加算しない）。
    
- **SPILL時にRS=0へ**（物理的に片付け）。
    

---

## 却下・保留

- **SPILL確率計算／ダイス**：**不採用**（物理溢れのみで判定）。
    
- **初期向きの分離案**（飲むタグキャリー等）：**不採用**。  
    → **TFがOrderとSeed（次サイクル初手タグ）の二重支配**で統一。
    
- **提案A/B/C**：
    
    - A（義務スロット）＝**優先表と重複** → 見送り
        
    - B（貸借メモ）＝**煩雑** → 見送り
        
    - C（Ø補）＝方向性は良／**保留**（Ø多用回で再検）
        

---

## 意図（なぜこうしたか）

- **物質性→構造**：残骸RSが実容量を圧迫→**実溢れがトリガー**。
    
- **監査性・再現性**：確率や余計なカウントを排し、**ログ最小**で追跡可能に。
    
- **鎖（聴取→次ノブ）の純化**：初手のみ特例を避け、**SeedTag=直前TFタグ**で自然に始動。
    

---

## ログテンプレ（最小）

`Order=標準 / T=T1 仕込み: V2 / O1 / M+1/5（部分） / RØ / F2  → 刺 TU: RISE_CCW(+1/5)   # 刺・優先表 … 実溢れ → ★SP   T3＋ALL+1/5／刺固定   飲む → TF=OT_CW(+1/5)   # Order更新／SeedTag(next)=刺   RS=0（氷・レ除去） 休憩1分 Next: T=再抽選 / FM=12時 / Stir=1回 / Order=更新後 Start: 初手の向き = T × SeedTag(next=刺)`

---

## 明日の宿題

- **RS更新のタイミング**：`RS: 氷x, レy` を**仕込み末**で統一するか要確認。
    
- **Ø上限=2枠**の妥当性（実演で味が痩せないか検証）。
    
- **A4早見差し替え**：SPILL新手順（飲む=TF含む）とØ分岐を反映。
    

---

## コミット案

`docs: rename 仕込みA→仕込み spec(v0.98–Ø): add Ø & partial-fill rules; cap Ø<=2 and forbid consecutive Ø per material spec: unify TU/TF priority (T-agnostic); add edge-avoid + TU whiff spill: redefine as physical overflow only; event= T3→刺固定→飲む+TF→clear RS→rest init-next: seedTag from last TF; start dir = T × seedTag runtime: RS accumulates only at 仕込み; cleared on SPILL`
