# テイストフィックス（Taste Fix／TF）— 詳細仕様  

## 0. 位置づけと目的

- テイストフィックスは、各サイクルの「飲む」の直後に行う**味から音への介入**である。
    
- 目的は、当サイクルの聴取結果（音タグ：**刺／無／だ**）に対して**最小刻み（±1クリック＝±1/5）**の是正を**1本だけ**与えること。
    
- テイストフィックスは**方向表（T0／T1／T2）に依存しない**（= **T非依存**）。向きは優先規則と端ノブ回避で定まる。
    

## 1. 実行回数・量・対象

- **各サイクル1回**、**対象は1本のみ**。
    
- ノブ操作量は**±1クリック（=±1/5）**に限定する。
    
- **端ノブ回避**：在位が**0/5 または 5/5**のノブは**選ばない**（ただし**+1クリックで端到達は可**）。
    
- 残骸は、テイストフィックスでも**加算する**。
    

## 2. 候補の選び方（優先順位）

味を確認し、下の優先順位に従って**選べるノブ（＝端在位でないノブ）**を一つだけ選ぶ。

- **刺** → **氷（FALL）** → **美酢（OT）**
    
- **だ** → **レモン（RISE）** → **炭酸（MULTI）**
    
- **無** → **焼酎（VARI）**（**時計回り優先／不可なら反時計回り**）
    

> 注記：タグ＝無の場合のみ、**対象も方向もルール固定**（VARIを選ぶ、CW優先）。  
> タグ＝刺／だの場合、**対象は上の優先表**で決め、**方向（CW／CCW）は “最小修正として適切な向き” を±1クリックだけ与える**（固定方向は持たない）。

## 3. 実施可否と「見送り」

- 候補が**全て端在位**で選べない場合のみ、**テイストフィックスの見送り**を許可する（＝**今サイクルは実施しない**）。
    
- 見送り時は**Order（仕込み順）を更新しない**。
    
- 「空振りテイストフィックス」という概念は**用いない**（素材だけ追加という動作はTFには存在しない）。
    

## 4. 手順（時系列）

1. **飲む**（当サイクルの結果を評価）。
    
2. **音タグ**（刺／無／だ）を確認。
    
3. **優先表**と**端ノブ回避**に従って**対象を1本**選ぶ。
    
4. **±1クリック（=±1/5）**だけ回す。
    
    - タグ＝無：**焼酎（VARI）**を**時計回り優先**（不可なら反時計回り）。
        
    - タグ＝刺／だ：**最小修正になる向き**を選んで±1クリック。
        
5. **Order更新**：**TFの「対象 × 向き」**で**次サイクルの Order を回転**する（下記5）。
    
6. 候補が全て端在位なら**見送り**（Orderは**不変**）。
    

## 5. Order（仕込み順）の更新ルール

- Order は**円環**として扱う。
    
- **更新手続**：**TFの対象素材**を**起点**に、**指定された向き（CW／CCW）に回す**操作として**Orderを回転**し、**次サイクルの先頭（初手）**を決める。
    
    - 言い換え：**次サイクルでは、TFで選んだ素材から仕込みを始める**。
        
    - **向きの情報（CW／CCW）**は「どちら側へ回転してその素材を先頭に据えたか」を記録・参照するために保持する（ログに残す）。
        
- **ノブ位置はリセットしない**（「先頭だけ0、他12時」は**上演開始時**の初期化規則であり、サイクルごとには適用しない）。
    
- これにより、**向きが反転**したり**対象が変わったりすると、先頭素材が入れ替わり**、さらに**次々サイクルでも前サイクルの Order を起点**とするため、**累積的な“ずれ”が可視化**される。
    

## 6. SPILL との関係（参照）

- **SPILLが発生したサイクル**でも、**飲む → テイストフィックス**は**通常どおり実施**する。
    
- そのテイストフィックスで得られた**判定タグ**は**SeedTag(next)** として次サイクル初手の向き決定に用いられる（SPILLの規定に従う）。
    
- SPILL のその他の手順（T3／ALL／残骸リセット等）は、SPILL章に従う。
    

---

# ログ（略語あり）— 記入例

### 凡例（ログ内）

- **TF**＝テイストフィックス
    
- **VARI／OT／MULTI／RISE／FALL**＝焼酎／美酢／炭酸／レモン／氷
    
- **CW／CCW**＝時計回り／反時計回り
    
- **NextOrder ← TF(対象,向き)**＝「対象と向きで Order を回転して次サイクル先頭を決定」
    
- **見送り**＝全候補が端在位でTFを実施しない（Order不変）
    

### 記入例

1. タグ＝刺（第1候補のレモンを最小で和らげる）  
    `TF → RISE_CCW(+1/5) → NextOrder ← TF(RISE,CCW)`
    
2. タグ＝刺（レモンが端在位で不可→炭酸で微調整）  
    `TF → MULTI_CW(+1/5) → NextOrder ← TF(MULTI,CW)`
    
3. タグ＝だ（第2候補の美酢で上げる）  
    `TF → OT_CW(+1/5) → NextOrder ← TF(OT,CW)`
    
4. タグ＝無（規定：焼酎をCW優先で最小修正）  
    `TF → VARI_CW(+1/5) → NextOrder ← TF(VARI,CW)`
    
5. タグ＝無（VARIのCWが端在位→CCWで最小）  
    `TF → VARI_CCW(+1/5) → NextOrder ← TF(VARI,CCW)`
    
6. **見送り**（全候補が端在位のため実施せず）  
    `TF → 見送り（Order不変）`
    
7. **SPILL中のサイクル**（通常通り実施・記録）  
    `TF → RISE_CCW(+1/5) → NextOrder ← TF(RISE,CCW) ★SPILLサイクル内`
